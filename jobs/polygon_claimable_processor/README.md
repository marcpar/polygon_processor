# Claimable Processor

see [claimable process](../../docs/claimables/README.md)

# Environment Configuration
| Key | Description |
| :-- | :---------- |
| `AZURE_ACCOUNT_NAME` | **REQUIRED**. azure account name |
| `AZURE_ACCOUNT_KEY` | **REQUIRED**. azure secret key |
| `TOPIC` | **REQUIRED**. name of the topic |
| `PRIVATE_KEY`| **REQUIRED**. private key of the wallet that will mint the nft |
| `NFT_CONTRACT_ADDRESS` | **REQUIRED**. address of the nft smart contract (claimable) |
| `FT_CONTRACT_ADDRESS` | **REQUIRED**. address of the ft smart contract (gas token) |
| `DEFAULT_CALLBACK_URL` | **REQUIRED**. endpoint where webhook events are sent |
| `MAX_JOBS` | maximum number of jobs to be processed at the same time, setting to 0 will have no limit |
| `LOG_LEVEL` | [winston log level](https://www.npmjs.com/package/winston#logging-levels)|
| `CLAIM_BASE_URL` | **REQUIRED**. base url of the claim frontend |
| `RPC_URL` | **REQUIRED**. rpc node to use |

# Job Spec
```json
{
    "JobId": "ff975cbd-32f4-4f09-9b9a-01964dd6eb90",
    "TokenId": "1"
}
```

| Field | Description |
| :---- | :---------- |
| `JobId` | **REQUIRED**. A unique string generated by the publisher of the message |
| `TokenId` | **REQUIRED**. Id of the token that will be processed into a claimable nft |

## Events

the processor will emit events and send it to the configured `DEFAULT_CALLBACK_URL`.

### Started Event
Emmited to notify the callback url that the processor has received the job and is currently processing it.
```json
{
    "JobId": "ff975cbd-32f4-4f09-9b9a-01964dd6eb90",
    "Event": "started",
    "Time": 1659965535,
    "Message": "Job Started"
}
```
### Failure Event
Emmited to notify the callback url that an error has occured.
```json
{
    "JobId": "ff975cbd-32f4-4f09-9b9a-01964dd6eb90",
    "Event": "failure",
    "Time": 1659965535,
    "Message": "Example Error Message"
}

```
### Success Event
Emmited to notify the callback url that the job has successfully finished.
```json
{
    "JobId": "ff975cbd-32f4-4f09-9b9a-01964dd6eb90",
    "Event": "success",
    "Message": "Job ff975cbd-32f4-4f09-9b9a-01964dd6eb90 has been successfully processed",
    "Details": {
        "ClaimURL": "https://polygon.claimablenfts.com/claim/<CONTRACT-ADDRESS>/<token-id>#<SECRET>",
        
    },
    "Time": 1661128110153
}
```
| Field | Description |
| :---- | :---------- |
| `Details.ClaimURL` | Claimable Link, should be sent security to the owner of the nft |